"use strict";function OSCOM_runRecaptcha(){OSCOM.a._.Ambassadors.gSecurityCheck=grecaptcha.render("cnSecurityCheck",{sitekey:OSCOM.a.vars.recaptcha_key_public,callback:function(response){OSCOM.a.vars.grecaptcharesponse=response}}),$("#ambCreateAccountLink").click()}void 0===OSCOM.a._&&(OSCOM.a._={}),OSCOM.a._.Ambassadors={execute:function(){let address,paymentButtonText=$("#ambPaymentButton").html(),hasError=!1,gSecurityCheck,panelCurrent="Start",panelLast,btDropinInstance;if("MutationObserver"in window){let paymentButtonObserver;new MutationObserver(function(mutations){mutations.forEach(function(mutation){null===mutation.oldValue?($("#ambPaymentButton").siblings("svg.svg-inject").addClass("d-none"),$("#ambPaymentButton").html()!=$("#ambPaymentButton").data("processing-text")&&$("#ambPaymentButton").removeClass("btn-success").addClass("btn-secondary")):$("#ambPaymentButton").html()!=$("#ambPaymentButton").data("processing-text")?($("#ambPaymentButton").siblings("svg.svg-inject").removeClass("d-none"),$("#ambPaymentButton").removeClass("btn-secondary").addClass("btn-success")):($("#ambPaymentButton").data("original-text")&&$("#ambPaymentButton").html($("#ambPaymentButton").data("original-text")).removeData("original-text"),$("#ambPaymentButton").siblings("svg.svg-inject").addClass("d-none"),$("#ambPaymentButton").removeClass("btn-success").addClass("btn-secondary"))})}).observe(document.getElementById("ambPaymentButton"),{attributes:!0,attributeOldValue:!0,attributeFilter:["disabled"]})}function showPanel(panel){panelLast=panelCurrent,panelCurrent=panel,$("#amb"+panelLast).addClass("d-none"),$("#amb"+panelCurrent).removeClass("d-none"),$("#ambTitle")[0].scrollIntoView({behavior:"smooth"})}function showMessage(id,message,type){void 0===type&&(type="danger"),$("#"+id+" div.alert-"+type).append("<p>"+message+"</p>").removeClass("d-none")}function showInlineError(id,error){hasError=!0,void 0===error&&(error=$("#"+id).parent().find(".form-text.text-muted").html()),$("#"+id).parent().find(".invalid-feedback").html(error),$("#"+id).parent().find(".form-text.text-muted").addClass("d-none"),$("#"+id).addClass("is-invalid")}function clearInlineError(id){$("#"+id).parent().find(".invalid-feedback").html(""),$("#"+id).removeClass("is-invalid"),$("#"+id).parent().find(".form-text.text-muted").removeClass("d-none")}function prefillBillingAddress(){void 0!==OSCOM.a.vars.billing_address&&($("#cFirstName").val(OSCOM.a.vars.billing_address.firstname),$("#cLastName").val(OSCOM.a.vars.billing_address.lastname),$("#cStreetAddress").val(OSCOM.a.vars.billing_address.street),$("#cStreetAddress2").val(OSCOM.a.vars.billing_address.street2),$("#cCity").val(OSCOM.a.vars.billing_address.city),$("#cZip").val(OSCOM.a.vars.billing_address.zip),$("#cCountry").val(OSCOM.a.vars.billing_address.country_iso_2).trigger("change"),OSCOM.a.vars.billing_address.country_iso_2 in OSCOM.a.vars.zones?$("#cStateSelect").val(OSCOM.a.vars.billing_address.zone_code).trigger("change"):$("#cState").val(OSCOM.a.vars.billing_address.state))}function initializeBt(){$.post(OSCOM.a.vars.rpc_braintree_client_token_url,address,function(result){if(void 0!==result.rpcStatus&&1===result.rpcStatus&&void 0!==result.token){$("#orderBillingAddress").html(result.addressFormatted),$("#orderTable").empty(),$.each(result.items,function(i,value){$("#orderTable").append("<tr><td>"+value.title+'</td><td align="right">'+value.cost+"</td></tr>")}),$.each(result.totals,function(i,value){$("#orderTable").append('<tr><td align="right">'+value.title+':</td><td align="right">'+value.cost+"</td></tr>")});let blush="Uh, thanks for reading this <3 #vollgerne";showPanel("Payment");try{createDropinInstance(result)}catch(err){return showMessage("ambPayment",OSCOM.lang.amb_error_payment_general),!1}}},"json").always(function(){$("#ambBillingAddressButton").html($("#ambBillingAddressButton").data("original-text")).removeData("original-text").prop("disabled",!1)})}function createDropinInstance(result){if("undefined"==typeof braintree){let script=document.createElement("script");return script.src=result.braintree_web_dropin_url,document.body.append(script),script.onload=function(){createDropinInstance(result)},script.onerror=function(){return showMessage("ambPayment",OSCOM.lang.amb_error_payment_general),!1},!1}let total_raw=result.totals.total.cost_raw,dropinParameters={authorization:result.token,container:"#ambBtForm",paymentOptionPriority:["paypal","card"],threeDSecure:{amount:total_raw},paypal:{flow:"checkout",amount:total_raw,currency:OSCOM.currency,displayName:"osCommerce",enableShippingAddress:!1,buttonStyle:{size:"small",color:"blue",shape:"rect"}}};void 0!==result.googleMerchantId&&(dropinParameters.paymentOptionPriority.push("googlePay"),dropinParameters.googlePay={googlePayVersion:2,merchantInfo:{merchantId:result.googleMerchantId,merchantName:"osCommerce"},transactionInfo:{totalPriceStatus:"FINAL",totalPrice:total_raw,currencyCode:OSCOM.currency},allowedPaymentMethods:[{type:"CARD",parameters:{billingAddressRequired:!0,billingAddressParameters:{format:"FULL"}}}]}),braintree.dropin.create(dropinParameters,function(createErr,instance){if($("#ambPaymentChangeAddressButton").removeClass("invisible"),createErr)return showMessage("ambPayment",OSCOM.lang.amb_error_payment_general),!1;btDropinInstance=instance,$("#ambPaymentButton").html(paymentButtonText+" "+result.totals.total.cost).removeClass("d-none"),$("#ambPaymentTerms").removeClass("d-none"),btDropinInstance.isPaymentMethodRequestable()&&$("#ambPaymentButton").prop("disabled",!1),btDropinInstance.on("paymentMethodRequestable",function(event){$("#ambPaymentButton").html()!=$("#ambPaymentButton").data("processing-text")&&$("#ambPaymentButton").prop("disabled",!1)}),btDropinInstance.on("noPaymentMethodRequestable",function(){$("#ambPaymentButton").prop("disabled",!0)})})}function processTransaction(nonce){let params={nonce:nonce,address:address};$.post(OSCOM.a.vars.rpc_braintree_process_url,params,function(result){if(void 0!==result.rpcStatus)if(1===result.rpcStatus){if(showPanel("Success"),void 0!==result.amb_profile){let firmHandshakes=$("#newestAmbMembers div:first").clone();$(firmHandshakes).find("a").attr("href",result.amb_profile.profile_url),$(firmHandshakes).find("img").attr({src:result.amb_profile.photo_url,title:result.amb_profile.name}),$(firmHandshakes).addClass("animationNewAmbassador"),$("#newestAmbMembers div:last").remove(),$("#newestAmbMembers").prepend(firmHandshakes)}}else reinitializeBt(),showMessage("ambPayment",OSCOM.lang.amb_error_payment_transaction+" "+result.errorMessage);else reinitializeBt(),showMessage("ambPayment",OSCOM.lang.amb_error_payment_general)},"json").fail(function(){reinitializeBt(),showMessage("ambPayment",OSCOM.lang.amb_error_payment_general)})}function reinitializeBt(){btDropinInstance.clearSelectedPaymentMethod()}$("#currencySelector").on("change",function(e){void 0!==OSCOM.a.vars.ambPrices[$(this).val()]&&($("#ambPrice").html(OSCOM.a.vars.ambPrices[$(this).val()]),OSCOM.currency=$(this).val(),Cookies.set("oscom_currency",$(this).val(),{expires:365}))}),$("#cCountry").on("change",function(e){""===$(this).val()?($("#cState, #cStateSelect").addClass("d-none"),$("#cState").siblings(".form-control-plaintext").removeClass("d-none"),$("#cState").siblings("label").removeAttr("for")):$(this).val()in OSCOM.a.vars.zones?($("#cStateSelect").empty(),$("#cStateSelect").append('<option value="">'+OSCOM.lang.amb_select_please_select+"</option>"),OSCOM.a.vars.zones[$(this).val()].forEach(function(value){$("#cStateSelect").append('<option value="'+value.code+'">'+value.title+"</option>")}),$("#cState").siblings(".form-control-plaintext").addClass("d-none"),$("#cState").addClass("d-none"),$("#cStateSelect").removeClass("d-none"),$("#cState").siblings("label").attr("for","cStateSelect")):($("#cState").siblings(".form-control-plaintext").addClass("d-none"),$("#cStateSelect").addClass("d-none"),$("#cState").removeClass("d-none"),$("#cState").siblings("label").attr("for","cState"))}),$("#ambStartButton").on("click",function(e){e.preventDefault(),!0===OSCOM.a.vars.loggedIn?(prefillBillingAddress(),showPanel("BillingAddress")):showPanel("Login")}),$("#ambCreateAccountLink").on("click",function(e){if(e.preventDefault(),showPanel("CreateAccount"),"undefined"==typeof grecaptcha){let script=document.createElement("script");return script.src="https://www.google.com/recaptcha/api.js?hl="+OSCOM.a.vars.language_code+"&render=explicit&onload=OSCOM_runRecaptcha",document.body.append(script),script.onerror=function(){showMessage("ambCreateAccount",OSCOM.lang.amb_error_create_general)},!1}}),$("#ambLoginLink").on("click",function(e){e.preventDefault(),showPanel("Login")}),$("#ambLoginForm").submit(function(e){if(e.preventDefault(),!0===$("#ambLoginButton").prop("disabled"))return!1;if($("#ambLogin div.alert").empty().addClass("d-none"),hasError=!1,$("#ambLoginButton").prop("disabled",!0).data("original-text",$("#ambLoginButton").html()).html($("#ambLoginButton").data("processing-text")),$("#cUsername").val($("#cUsername").val().trim()),clearInlineError("cUsername"),($("#cUsername").val().length<3||$("#cUsername").val().length>26)&&showInlineError("cUsername",OSCOM.lang.amb_error_login_username),clearInlineError("cPassword"),($("#cPassword").val().length<3||$("#cPassword").val().length>32)&&showInlineError("cPassword",OSCOM.lang.amb_error_login_password),!0===hasError)$("#ambLoginButton").html($("#ambLoginButton").data("original-text")).removeData("original-text").prop("disabled",!1);else{let params={public_token:$('#ambLoginForm input[name="public_token"]').val(),username:$("#cUsername").val(),password:$("#cPassword").val(),sendVerification:"1",addressType:"billing"};$.post(OSCOM.a.vars.rpc_login_url,params,function(result){if(void 0!==result.rpcStatus)if(1===result.rpcStatus)OSCOM.a.vars.loggedIn=!0,void 0!==result.address&&(OSCOM.a.vars.billing_address=result.address,prefillBillingAddress()),showPanel("BillingAddress");else if(void 0!==result.errorCode&&"not_verified"===result.errorCode)$("#ambVerifyEmailAddress").html(result.email),showPanel("VerifyAccount");else{let e=void 0!==result.errors?result.errors:[];e.length<1&&e.push(OSCOM.lang.amb_error_login_general),e.forEach(function(v){showMessage("ambLogin",v)})}else showMessage("ambLogin",OSCOM.lang.amb_error_general)},"json").fail(function(){showMessage("ambLogin",OSCOM.lang.amb_error_general)}).always(function(){$("#ambLoginButton").html($("#ambLoginButton").data("original-text")).removeData("original-text").prop("disabled",!1)})}}),$("#ambVerifyAccountForm").submit(function(e){if(e.preventDefault(),!0===$("#ambVerifyAccountButton").prop("disabled"))return!1;if($("#ambVerifyAccount div.alert").empty().addClass("d-none"),hasError=!1,$("#ambVerifyAccountButton").prop("disabled",!0).data("original-text",$("#ambVerifyAccountButton").html()).html($("#ambVerifyAccountButton").data("processing-text")),$("#cvUserId").val($("#cvUserId").val().trim()),clearInlineError("cvUserId"),(null===$("#cvUserId").val().match(/^\d+$/g)||$("#cvUserId").val()<1)&&showInlineError("cvUserId",OSCOM.lang.amb_error_verify_user_id),$("#cvKey").val($("#cvKey").val().trim()),clearInlineError("cvKey"),32===$("#cvKey").val().length&&null!==$("#cvKey").val().match(/^[a-zA-Z0-9\-\_]+$/g)||showInlineError("cvKey",OSCOM.lang.amb_error_verify_user_key),!0===hasError)$("#ambVerifyAccountButton").html($("#ambVerifyAccountButton").data("original-text")).removeData("original-text").prop("disabled",!1);else{let params={public_token:$('#ambVerifyAccountForm input[name="public_token"]').val(),user_id:$("#cvUserId").val(),key:$("#cvKey").val()};$.post(OSCOM.a.vars.rpc_verify_url,params,function(result){if(void 0!==result.rpcStatus)if(1===result.rpcStatus){let login_params;"Login"===panelLast?login_params={public_token:$('#ambLoginForm input[name="public_token"]').val(),username:$("#cUsername").val(),password:$("#cPassword").val()}:"CreateAccount"===panelLast&&(login_params={public_token:$('#ambCreateAccountForm input[name="public_token"]').val(),username:$("#cnUsername").val(),password:$("#cnPassword").val()}),void 0!==login_params.username?$.post(OSCOM.a.vars.rpc_login_url,login_params,function(login_result){void 0!==login_result.rpcStatus&&1===login_result.rpcStatus?(OSCOM.a.vars.loggedIn=!0,void 0!==login_result.address&&(OSCOM.a.vars.billing_address=login_result.address,prefillBillingAddress()),showPanel("BillingAddress")):showPanel("Login")},"json").fail(function(){showPanel("Login")}).always(function(){$("#ambVerifyAccountButton").html($("#ambVerifyAccountButton").data("original-text")).removeData("original-text").prop("disabled",!1)}):showPanel("Login")}else if(void 0!==result.errorCode&&"already_verified"===result.errorCode)showMessage("ambLogin","already_verified"),$("#cvUserId, #cvKey, #cUsername, #cPassword").val(""),showPanel("Login");else{let e=void 0!==result.errors?result.errors:[];e.length<1&&e.push(OSCOM.lang.amb_error_verify_general),e.forEach(function(v){showMessage("ambVerifyAccount",v)})}else showMessage("ambVerifyAccount",OSCOM.lang.amb_error_verify_general)},"json").fail(function(){showMessage("ambVerifyAccount",OSCOM.lang.amb_error_verify_general)}).always(function(){$("#ambVerifyAccountButton").html($("#ambVerifyAccountButton").data("original-text")).removeData("original-text").prop("disabled",!1)})}}),$("#ambCreateAccountForm").submit(function(e){if(e.preventDefault(),!0===$("#ambCreateAccountButton").prop("disabled"))return!1;if($("#ambCreateAccount div.alert").empty().addClass("d-none"),hasError=!1,$("#ambCreateAccountButton").prop("disabled",!0).data("original-text",$("#ambCreateAccountButton").html()).html($("#ambCreateAccountButton").data("processing-text")),$("#cnUsername").val($("#cnUsername").val().trim()),clearInlineError("cnUsername"),($("#cnUsername").val().length<3||$("#cnUsername").val().length>26)&&showInlineError("cnUsername"),$("#cnEmail").val($("#cnEmail").val().trim()),clearInlineError("cnEmail"),""!==$("#cnEmail").val()&&null!==$("#cnEmail").val().match(/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/g)||showInlineError("cnEmail",OSCOM.lang.amb_error_create_email_address),clearInlineError("cnPassword"),($("#cnPassword").val().length<3||$("#cnPassword").val().length>32)&&showInlineError("cnPassword"),clearInlineError("cnSecurityCheck"),(void 0===OSCOM.a.vars.grecaptcharesponse||OSCOM.a.vars.grecaptcharesponse.length<1)&&showInlineError("cnSecurityCheck",OSCOM.lang.amb_error_create_security_check),!0===hasError)$("#ambCreateAccountButton").html($("#ambCreateAccountButton").data("original-text")).removeData("original-text").prop("disabled",!1);else{let params={public_token:$('#ambCreateAccountForm input[name="public_token"]').val(),username:$("#cnUsername").val(),email:$("#cnEmail").val(),password:$("#cnPassword").val(),gr_security_check:OSCOM.a.vars.grecaptcharesponse,sendVerification:"1"};$.post(OSCOM.a.vars.rpc_create_url,params,function(result){if(void 0!==result.rpcStatus)if(1===result.rpcStatus)showMessage("ambVerifyAccount",OSCOM.lang.amb_create_verify_account,"success"),$("#ambVerifyEmailAddress").html(result.email),showPanel("VerifyAccount");else{let e=void 0!==result.errors?result.errors:[];e.length<1&&e.push(OSCOM.lang.amb_error_create_general),e.forEach(function(v){showMessage("ambCreateAccount",v)}),void 0!==result.resetGSecurityCheck&&!0===result.resetGSecurityCheck&&grecaptcha.reset(void 0)}else showMessage("ambCreateAccount",OSCOM.lang.amb_error_create_general)},"json").fail(function(){showMessage("ambCreateAccount",OSCOM.lang.amb_error_create_general)}).always(function(){$("#ambCreateAccountButton").html($("#ambCreateAccountButton").data("original-text")).removeData("original-text").prop("disabled",!1)})}}),$("#ambBillingAddressButton").on("click",function(e){if(e.preventDefault(),!0===$("#ambBillingAddressButton").prop("disabled"))return!1;$("#ambBillingAddress div.alert").empty().addClass("d-none"),hasError=!1,$("#ambBillingAddressButton").prop("disabled",!0).data("original-text",$("#ambBillingAddressButton").html()).html($("#ambBillingAddressButton").data("processing-text")),$("#cFirstName").val($("#cFirstName").val().trim()),clearInlineError("cFirstName"),$("#cFirstName").val().length<1&&showInlineError("cFirstName",OSCOM.lang.amb_error_billing_firstname),$("#cLastName").val($("#cLastName").val().trim()),clearInlineError("cLastName"),$("#cLastName").val().length<1&&showInlineError("cLastName",OSCOM.lang.amb_error_billing_lastname),$("#cStreetAddress").val($("#cStreetAddress").val().trim()),clearInlineError("cStreetAddress"),$("#cStreetAddress").val().length<1&&showInlineError("cStreetAddress",OSCOM.lang.amb_error_billing_street_address),$("#cCity").val($("#cCity").val().trim()),$("#cZip").val($("#cZip").val().trim()),clearInlineError("cCountry"),""===$("#cCountry").val()&&showInlineError("cCountry"),$("#cState").val($("#cState").val().trim()),clearInlineError("cStateSelect"),$("#cCountry").val()in OSCOM.a.vars.zones&&""===$("#cStateSelect").val()&&showInlineError("cStateSelect"),!1===hasError?(address={firstname:$("#cFirstName").val(),lastname:$("#cLastName").val(),street:$("#cStreetAddress").val(),street2:$("#cStreetAddress2").val(),city:$("#cCity").val(),zip:$("#cZip").val(),country:$("#cCountry").val()},$("#cCountry").val()in OSCOM.a.vars.zones?address.zone=$("#cStateSelect").val():address.zone=$("#cState").val(),initializeBt()):$("#ambBillingAddressButton").html($("#ambBillingAddressButton").data("original-text")).removeData("original-text").prop("disabled",!1)}),$("#ambPaymentChangeAddressButton").on("click",function(e){e.preventDefault(),btDropinInstance.teardown(function(err){showPanel("BillingAddress"),$("#ambPaymentChangeAddressButton").addClass("invisible")})}),$("#ambPaymentButton").on("click",function(e){e.preventDefault(),$("#ambPayment div.alert").empty().addClass("d-none"),$("#ambPaymentButton").data("original-text",$("#ambPaymentButton").html()).html($("#ambPaymentButton").data("processing-text")).prop("disabled",!0),btDropinInstance.requestPaymentMethod(function(requestPaymentMethodErr,payload){return requestPaymentMethodErr?(showMessage("ambPayment",OSCOM.lang.amb_error_payment_general),$("#ambPaymentButton").data("original-text")&&$("#ambPaymentButton").html($("#ambPaymentButton").data("original-text")).removeData("original-text"),$("#ambPaymentButton").prop("disabled",!1),!1):"CreditCard"===payload.type&&!0!==payload.liabilityShifted&&!1!==payload.liabilityShiftPossible?(reinitializeBt(),showMessage("ambPayment",OSCOM.lang.amb_error_payment_general),!1):void processTransaction(payload.nonce)})})}},"_"===OSCOM.siteReq.app&&"Ambassadors"===OSCOM.siteReq.actions.join(".")&&OSCOM.a._.Ambassadors.execute();
//# sourceMappingURL=Ambassadors.min.js.map