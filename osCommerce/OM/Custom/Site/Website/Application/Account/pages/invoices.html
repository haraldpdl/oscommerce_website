<div class="row">
  {widget}account_sidebar_nav{widget}

  <div id="maincontainer" class="col-sm-9 col-sm-pull-3">
    <div id="maincontent">
      <h1>{lang}invoices_title{lang}</h1>

      {widget}message_stack|account{widget}

      <p>{lang}invoices_introduction{lang}</p>

      <div class="panel-group" id="invlist" role="tablist" aria-multiselectable="true"></div>
    </div>
  </div>
</div>

<script>
$(function() {
  var invoices = {raw json_encode}invoices{raw};
  var invoices_link = {raw json_encode}invoices_link{raw};

  var invoices_current_year = null;

  for (var i = 0, n = invoices.length; i < n; i++ ) {
    if (invoices_current_year !== invoices[i].year) {
      invoices_current_year = invoices[i].year;

      $('#invlist').append(
        '<div id="panel' + invoices[i].year + '" class="panel panel-info">' +
        '  <div class="panel-heading" role="tab" id="heading' + invoices[i].year + '">' +
        '    <h4 class="panel-title">' +
        '      <a role="button" data-toggle="collapse" data-parent="#invlist" href="#collapse' + invoices[i].year + '" aria-expanded="true" aria-controls="collapse' + invoices[i].year + '">' + invoices[i].year + '</a>' +
        '    </h4>' +
        '  </div>' +
        '  <div id="collapse' + invoices[i].year + '" class="panel-collapse collapse' + (i === 0 ? ' in' : '') + '" role="tabpanel" aria-labelledby="heading' + invoices[i].year + '">' +
        '    <div class="panel-body">' +
        '      <table class="table table-hover table-condensed">' +
        '        <tbody>' +
        '        </tbody>' +
        '      </table>' +
        '    </div>' +
        '  </div>' +
        '</div>'
      );
    }

    var status = '';

    switch (invoices[i].status) {
      case 'pending':
        status = '<span class="label label-warning">{lang}invoices_status_pending{lang}</span>';
        break;

      case 'paid':
        status = '<span class="label label-success">{lang}invoices_status_paid{lang}</span>';
        break;
    }

    $('#collapse' + invoices[i].year + ' .panel-body table tbody').append(
      '<tr>' +
      '  <td>' + invoices[i].title + ' <small>' + invoices[i].number + '</small><br /><small>' + invoices[i].date + '</small></td>' +
      '  <td>' + invoices[i].cost + '</td>' +
      '  <td>' + status + '</td>' +
      '  <td align="right"><a href="' + invoices_link.replace('%number%', invoices[i].number) + '"><i class="text-success glyphicon glyphicon-download-alt"></i></a></td>' +
      '</tr>'
    );
  }
});
</script>
