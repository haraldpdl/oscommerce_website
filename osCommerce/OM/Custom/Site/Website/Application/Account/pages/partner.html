<div class="row">
  {widget}account_sidebar_nav{widget}

  <div id="maincontainer" class="col-sm-9 col-sm-pull-3">
    <div id="maincontent">
      <h1>{lang}partner_title{lang}</h1>

      {widget}message_stack|partner{widget}

      <div id="ptabs">
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" id="ptabsActive"><a href="#pactive" aria-controls="pactive" role="tab" data-toggle="tab">{lang}partner_tab_active{lang} <span class="label label-success"></span></a></li>
          <li role="presentation" id="ptabsInactive"><a href="#pinactive" aria-controls="pinactive" role="tab" data-toggle="tab">{lang}partner_tab_inactive{lang} <span class="label label-danger"></span></a></li>
        </ul>

        <div class="tab-content">
          <div role="tabpanel" class="tab-pane" id="pactive"></div>
          <div role="tabpanel" class="tab-pane" id="pinactive"></div>
        </div>
      </div>
    </div>
  </div>
</div>

{loop partner_campaigns}
<div id="partnerc_#code#" class="hidden">
  <div class="panel">
    <div class="panel-heading">
      <div class="row">
        <div class="col-md-7">
          <h3 class="panel-title"><a href="{link}Account|Website|Partner&View=%code%|SSL{link}">#title#</a> <br class="visible-xs-block"> <small>in %category_title%</small></h3>
          <span class="pcdate small" style="font-size: 75%;">%date_end%</span> <span class="pcdays small" style="font-size: 75%;"></span>
        </div>

        <div class="col-md-5 text-right">
          <div class="btn-group" role="group">
            <a href="{link}Account|Website|Partner&Extend=%code%|SSL{link}" class="btn btn-sm">{lang}button_partner_extend{lang}</a>
            <a href="{link}Account|Website|Partner&Edit=%code%|SSL{link}" class="btn btn-sm">{lang}button_partner_edit{lang}</a>

            <div class="btn-group" role="group">
              <button type="button" class="btn btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="caret"></span>
              </button>

              <ul class="dropdown-menu dropdown-menu-right">
                <li><a href="{link}Account|Website|Partner&Sites=%code%|SSL{link}">{lang}button_partner_sites{lang}</a></li>
                <li><a href="{link}Account|Website|Partner&History=%code%|SSL{link}">{lang}button_partner_history{lang}</a></li>
                <li><a href="{link}Account|Website|Partner&Billing=%code%|SSL{link}">{lang}button_partner_billing{lang}</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{loop}

<script>
$(function() {
  var partner_date_now = moment('{value addslashes}partner_date_now{value}');

  $('[id^=partnerc_]').each(function() {
    var runsUntil = moment($('.pcdate', this).text());

    $('.pcdate', this).text(runsUntil.format('Do MMM, YYYY'));

    if (runsUntil.isBefore(partner_date_now)) {
      $(this).appendTo('#pinactive').removeClass('hidden');

      $('.panel', this).addClass('panel-danger');
      $('.panel .btn', this).addClass('btn-danger');

      $('.pcdays', this).html('(' + runsUntil.from(partner_date_now) + ')');
    } else {
      $(this).appendTo('#pactive').removeClass('hidden');

      var daysRemaining = runsUntil.diff(partner_date_now, 'days');

      $('.pcdays', this).html('(' + partner_date_now.to(runsUntil) + ')');

      if ( daysRemaining > 14 ) {
        $('.panel', this).addClass('panel-success');
        $('.panel .btn', this).addClass('btn-success');
      } else {
        $('.panel', this).addClass('panel-warning');
        $('.panel .btn', this).addClass('btn-warning');
      }
    }
  });

  var totalActive = $('#pactive div[id^=partnerc_]').length;
  var totalInactive = $('#pinactive div[id^=partnerc_]').length;

  if (totalActive > 0) {
    $('#ptabsActive .label').text(totalActive);
    $('#ptabsActive, #pactive').addClass('active');
  } else {
    $('#ptabsActive, #pactive').addClass('hidden');
  }

  if (totalInactive > 0) {
    $('#ptabsInactive .label').text(totalInactive);

    if (totalActive < 1) {
      $('#ptabsInactive, #pinactive').addClass('active');
    }
  } else {
    $('#ptabsInactive, #pinactive').addClass('hidden');
  }
});
</script>

<script src="public/external/momentjs/moment.min.js"></script>
