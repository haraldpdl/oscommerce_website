<script src="public/external/momentjs/moment.min.js"></script>

<div id="highlights">
  <img src="{publiclink}{raw}highlights_image{raw}{publiclink}" width="940" height="285" />
</div>

<div class="row">
  <div id="maincontainer" class="span9">
    <div id="maincontent">
      <h1>{lang}partner_title{lang}</h1>

      {widget}message_stack|partner{widget}

      <p>{lang}partner_introduction{lang}</p>

{loop partner_campaigns}
      <div id="partnerc_#code#">
        <div class="pull-right" style="text-align: right; padding-top: 5px;"><span class="pcdate label">%date_end%</span><br /><span class="pcdays muted"></span></div>
        <h4><a href="{link}Account|Website|Partner&View=%code%|SSL{link}">#title#</a> <small>(in %category_title%)</small></h4>
        <p><a href="{link}Account|Website|Partner&View=%code%|SSL{link}" class="btn">View</a> <a href="{link}Account|Website|Partner&Edit=%code%|SSL{link}" class="btn">Edit</a> <a href="{link}Account|Website|Partner&History=%code%|SSL{link}" class="btn">History</a></p>
      </div>
{loop}

      <p align="center"><small class="text-success">{lang}partner_multiple_discount_info{lang}</small></p>

<script>
var partner_date_now = moment('{value addslashes}partner_date_now{value}');

$(function() {
  $('[id^=partnerc_]').each(function() {
    var runsUntil = moment($('.pcdate', this).text());

    $('.pcdate', this).text(runsUntil.format('Do MMM, YYYY'));

    if ( runsUntil.isBefore(partner_date_now) ) {
      $('.pcdate', this).addClass('label-important');

      $('.pcdays', this).html('<small>' + partner_date_now.diff(runsUntil, 'days') + ' days ago</small>');
    } else {
      var daysRemaining = runsUntil.diff(partner_date_now, 'days');

      $('.pcdays', this).html('<small>' + daysRemaining + ' days remaining</small>');

      if ( daysRemaining > 14 ) {
        $('.pcdate', this).addClass('label-success');
      } else {
        $('.pcdate', this).addClass('label-warning');
      }
    }
  });
});
</script>

    </div>
  </div>

  {widget}account_sidebar_nav{widget}
</div>
